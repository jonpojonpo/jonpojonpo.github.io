<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Orc Invaders</title>
  <style>
    body, html {
      margin: 0;
      height: 100%;
      background-color: #4169E1;
      overflow: hidden;
    }

    canvas {
      display: block;
      position: absolute;
      top: 0;
      left: 0;
    }
  </style>
</head>
<body>
  <canvas id="gameCanvas"></canvas>
  <script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');

    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    const ship = {
      x: canvas.width / 2,
      width: 40,
      height: 20,
      speed: 5,
    };

    const munition = {
      x: 0,
      y: 0,
      radius: 5,
      speedX: 0,
      speedY: 0,
      fired: false,
      gravity: 2,
    };

    const invaders = [];
    const numInvaders = 50;
    const invaderSize = 20;
    const cityThreshold = canvas.height * 0.5;
    let civilianDeaths = 0;
    let invaderLives = 50;

    for (let i = 0; i < numInvaders; i++) {
      invaders.push({
        x: Math.random() * (canvas.width - invaderSize),
        y: canvas.height - invaderSize - Math.random() * (canvas.height * 0.1),
        width: invaderSize,
        height: invaderSize,
        speed: Math.random() * 0.2 + 0.1,
        lives: 1,
      });
    }



    function drawShip() {
      ctx.fillStyle = 'black';
      ctx.fillRect(ship.x - ship.width / 2, 10, ship.width, ship.height);
    }

    function drawMunition() {
      if (!munition.fired) return;

      ctx.fillStyle = 'red';
      ctx.beginPath();
      ctx.arc(munition.x, munition.y, munition.radius, 0, 2 * Math.PI);
      ctx.fill();
    }

    function drawInvaders() {
      ctx.fillStyle = 'green';
      for (const invader of invaders) {
        ctx.fillRect(invader.x, invader.y, invader.width, invader.height);
      }
    }

    function drawCornfield() {
      ctx.fillStyle = '#DAA520';
      ctx.fillRect(0, cityThreshold, canvas.width, canvas.height - cityThreshold);
    }

    function drawCivilianDeaths() {
      ctx.fillStyle = 'white';
      ctx.font = '16px Arial';
      ctx.fillText('Civilian Deaths: ' + civilianDeaths, 10, canvas.height - 10);
    }

    function drawInvaderLives() {
      ctx.fillStyle = 'white';
      ctx.font = '16px Arial';
      ctx.fillText('invaderLives: ' + invaderLives, canvas.width - 150 , canvas.height - 10);
    }

    function updateMunition() {
      if (!munition.fired) return;

      munition.x += munition.speedX;
      munition.y += munition.speedY;
      munition.speedY += munition.gravity * 0.01; // Apply gravity

     if (munition.y > canvas.height) {
       munition.fired = false;
     }
   }

   function updateInvaders() {
     for (let i = 0; i < invaders.length; i++) {
       const invader = invaders[i];

       invader.x += invader.speed * (invader.x < canvas.width / 2 ? 1 : -1);
       invader.y -= invader.speed * 0.5;

       if (munition.fired && checkCollision(invader, munition)) {
         invader.lives--;
         invaderLives--;
         munition.fired = false;

         if (invader.lives <= 0) {
           // Remove the invader from the invaders array.
           invaders.splice(i, 1);
           // Decrement the index so that the next iteration will process the correct invader.
           i--;
           continue;
         }
       }

       if (invader.y <= cityThreshold) {
         civilianDeaths++;
         invader.x = invader.x < canvas.width / 2 ? -invaderSize : canvas.width;
         invader.y = cityThreshold + Math.random() * (canvas.height - cityThreshold - invaderSize);
       }
     }
   }



   function checkCollision(rect, circle) {
     const distX = Math.abs(circle.x - rect.x - rect.width / 2);
     const distY = Math.abs(circle.y - rect.y - rect.height / 2);

     if (distX > (rect.width / 2 + circle.radius)) { return false; }
     if (distY > (rect.height / 2 + circle.radius)) { return false; }

     if (distX <= (rect.width / 2)) { return true; }
     if (distY <= (rect.height / 2)) { return true; }

     const dx = distX - rect.width / 2;
     const dy = distY - rect.height / 2;
     return (dx * dx + dy * dy <= (circle.radius * circle.radius));
   }

   function gameLoop() {
     ctx.clearRect(0, 0, canvas.width, canvas.height);

     drawCornfield();
     drawShip();
     drawMunition();
     drawInvaders();
     drawCivilianDeaths();
     drawInvaderLives();

     updateMunition();
     updateInvaders();
     // Check if invaderLives has reached 0 and display "Victory!" text.
     if (invaderLives === 0) {
       ctx.fillStyle = 'white';
       ctx.font = '72px Arial';
       ctx.fillText('SLAVA UKRAINI!', canvas.width / 2 - 70, canvas.height / 2);
     } else {
       requestAnimationFrame(gameLoop);
     }
   }


   gameLoop();

   window.addEventListener('keydown', (e) => {
     if (e.code === 'ArrowLeft') {
       ship.x -= ship.speed;
     } else if (e.code === 'ArrowRight') {
       ship.x += ship.speed;
     } else if (e.code === 'Space') {
       if (!munition.fired) {
         munition.x = ship.x;
         munition.y = 10 + ship.height;
         munition.speedX = 0;
         munition.speedY = 10;
         munition.fired = true;
       }
     }
   });
 </script>
</body>
</html>
